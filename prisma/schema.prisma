datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
	provider = "prisma-client-js"
	previewFeatures = ["fullTextSearch"]
}


model User {
	id String @id

	accounts    Account[]
	predictions Prediction[]
	wagers      Wager[]
}


model Account {
	guild   Guild @relation(fields: [guildID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	guildID String
	user    User  @relation(fields: [userID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	userID  String

	balance Float @default(100)

	@@unique([guildID, userID])
}


model Guild {
	id String @id

	kitty Float @default(0)

	accounts       Account[]
	predictions Prediction[]
}



enum PredictionStatus {
	OPEN
	PROCESSING
	PAID
}

model Prediction {
	id String @id
	status PredictionStatus @default(OPEN)

	author   User  @relation(fields: [authorID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	authorID String
	guild    Guild  @relation(fields: [guildID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	guildID  String

	title       String @db.VarChar(200)
	description String @db.VarChar(200)

	answer Int

	createdAt DateTime @default(now())
	updatedAt DateTime @default(now()) @updatedAt

	options PredictionOption[]
	wagers  Wager[]
}

model PredictionOption {
	index        Int
	prediction   Prediction  @relation(fields: [predictionID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	predictionID String

	text String @db.VarChar(200)

	@@unique([index, predictionID])
}

model Wager {
	prediction   Prediction  @relation(fields: [predictionID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	predictionID String
	user         User        @relation(fields: [userID], references: [id], onDelete: Cascade, onUpdate: Cascade)
	userID       String

	amount Float
	paid   Boolean @default(false)

	@@unique([predictionID, userID])
}